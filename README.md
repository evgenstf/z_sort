# О чем проект

z-sort - движок для технических статей, поддерживающий markdown, latex и возможность добавления интерактивных секций для статей.

# Архитектура

Две основные сущности:

* **article_manager** -- микросервис, управляющий статьями и предоставляющий api для их получения. Запускается скриптом **article_manager/run_article_manager.sh**
* **frontend** -- собственно сам фронтенд сервер на основе django. Принимает входящие http запросы на статьи, забирает их текст у article_manager и формирует http страницы с ними. Запускается скриптом **frontend/run_server.sh**

## article_manager

Внутри устроен предельно просто: обращается к стораджу со статьями (сейчас и на долгое время это файловое хранилище FileArticleStorage, реализованное в storage.file_article_storage) и отвечает на запросы трех типов (они приходят по tcp):

* article -- вернуть статью по определенному пути
* meta -- получить метаинформацию статьи (там всякие прикладные вещи вроде названия, авторов. времени создания и т.п.). Это нужно когда мы не хотим запрашивать весь текст (он может быть объемным)
* path_tree -- получить дерево статей. Возвращается просто граф, состоящий из категорий и статей в них.

## frontend

Устроен посложнее. Во-первых, есть стандартные джанговские сущности:

* settings.py, asgi.py, wsgi.py -- там указывается конфигурация сервера и всякий служебный мусор, включающий в себя перечисление разрешенных запросов, входящих адресов, установленных расширений и прочего мусора. Можно особо не вникать.
* manage.py -- точка старта сервера. Просто файл, вызывающий цикл обработки запросов.
* handlers/z_sort_handler.py -- обработчик запросов. Внутри принимает url, понимает че возвращать и идет к фабрикам формирования html страниц (о них дальше)

Во-вторых, есть статические ресурсы, в которые фабрики вставляют контент. Они находятся в папке static:

* html -- шаблоны html страниц. Например, в static/html/article.html ты можешь увидеть разметку страницы со статьей и внутри макросы вида &macros_name&. Фабрики потом вместо них вставят контент.
* js -- скрипты на js, пока можно не погружаться.
* css -- там описаны стили, в общем то тоже можно забить.

# Гайдлайны ведения репозитория

Очень важно содержать все в репозитории (как минимум мастер ветку) консистентно и в чистоте. Вот порядок действий, чтобы залить какое-то изменение:

1. Создаем бранч с названием `nickname/small_change_description`
2. Внутри бранча делаем что хотим, и потом создаем ревью для мерджа изменений в мастер
3. Проходим ревью
4. Заливаем в мастер, объединив все коммиты из ветки в один с названием по формату `[измененная сущность] краткое описание изменений`

# Как заливать изменения на продакшн сервер

1. Заливаем через ревью в мастер
2. Просим @evgenstf обновить продакшн сервер.

Пока так вручную, но потом нужно будет сделать нормальную доставку с тестированием.
